<!-- Module-specific background -->
<style>
.quiz-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background: 
        linear-gradient(135deg, rgba(231, 76, 60, 0.85), rgba(192, 57, 43, 0.8)),
        url('https://images.unsplash.com/photo-1606092195730-5d7b9af1efc5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
    background-size: cover;
    background-attachment: fixed;
    background-position: center;
}

.quiz-background::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 30% 70%, rgba(241, 196, 15, 0.12) 0%, transparent 50%),
        radial-gradient(circle at 70% 30%, rgba(46, 204, 113, 0.08) 0%, transparent 50%);
    animation: quizFloat 20s ease-in-out infinite;
}

@keyframes quizFloat {
    0%, 100% { transform: scale(1) rotate(0deg); }
    50% { transform: scale(1.01) rotate(0.2deg); }
}

/* Quiz styling */
.quiz-container {
    max-width: 900px;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 8px 30px rgba(0,0,0,0.15);
}

.quiz-header {
    text-align: center;
    margin-bottom: 2rem;
    padding: 2rem;
    background: linear-gradient(135deg, var(--primary-red), var(--secondary-red));
    color: white;
    border-radius: 15px;
}

.quiz-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 12px;
}

.stat-item {
    text-align: center;
    padding: 1rem;
    background: white;
    border-radius: 8px;
    border-left: 4px solid var(--primary-red);
}

.stat-number {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary-red);
    display: block;
}

.stat-label {
    font-size: 0.9rem;
    color: #6c757d;
    margin-top: 0.5rem;
}

.question-card {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    border-top: 4px solid var(--primary-red);
}

.question-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.question-topic {
    background: var(--primary-gold);
    color: var(--dark-navy);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.9rem;
}

.question-difficulty {
    color: var(--primary-red);
    font-weight: 600;
}

.question-text {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--dark-navy);
    line-height: 1.6;
    margin-bottom: 2rem;
}

.answers {
    display: grid;
    gap: 1rem;
}

.answer {
    background: #f8f9fa;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 1rem 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;
    line-height: 1.5;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.answer:hover {
    border-color: var(--primary-red);
    background: #fff5f5;
    transform: translateX(5px);
}

.answer.selected {
    background: var(--primary-red);
    color: white;
    border-color: var(--primary-red);
}

.answer.correct {
    background: #d4edda;
    color: #155724;
    border-color: #28a745;
}

.answer.incorrect {
    background: #f8d7da;
    color: #721c24;
    border-color: #dc3545;
}

.answer.disabled {
    opacity: 0.6;
    cursor: not-allowed;
    pointer-events: none;
}

.answer-label {
    background: var(--primary-red);
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    flex-shrink: 0;
}

.controls {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 2rem;
    flex-wrap: wrap;
}

.btn {
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 25px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary { background: #007bff; color: white; }
.btn-warning { background: #ffc107; color: #2d3436; }
.btn-secondary { background: #6c757d; color: white; }
.btn-success { background: #28a745; color: white; }

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2rem;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 12px;
}

.results {
    display: none;
    text-align: center;
}

.results-card {
    background: white;
    border-radius: 20px;
    padding: 3rem;
    box-shadow: 0 8px 30px rgba(0,0,0,0.15);
}

.final-score {
    font-size: 3rem;
    font-weight: 800;
    color: #28a745;
    margin-bottom: 1rem;
}

.results-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
}

.result-stat {
    padding: 1.5rem;
    border-radius: 12px;
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
}

@media (max-width: 768px) {
    .quiz-container { padding: 1rem; margin: 1rem; }
    .question-text { font-size: 1.1rem; }
    .controls { flex-direction: column; align-items: center; }
    .btn { width: 100%; max-width: 250px; justify-content: center; }
    .navigation { flex-direction: column; gap: 1rem; }
}
</style>

<div class="quiz-background"></div>

<div class="fade-in">
    <div class="quiz-container">
        <!-- Header -->
        <div class="quiz-header">
            <h1><i class="fas fa-brain"></i> Quiz Kiến Thức CNXH</h1>
            <p>Cơ cấu xã hội - giai cấp và liên minh giai cấp trong thời kỳ quá độ</p>
        </div>

        <!-- Stats -->
        <div class="quiz-stats">
            <div class="stat-item">
                <span class="stat-number" id="scoreDisplay">0</span>
                <div class="stat-label">Điểm số</div>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="livesDisplay">3</span>
                <div class="stat-label">Mạng sống</div>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="timeDisplay">0s</span>
                <div class="stat-label">Thời gian</div>
            </div>
            <div class="stat-item">
                <span class="stat-number"><span id="currentDisplay">1</span>/<span id="totalDisplay">8</span></span>
                <div class="stat-label">Tiến độ</div>
            </div>
        </div>

        <!-- Question Area -->
        <div class="question-card" id="questionArea">
            <div class="question-info">
                <div class="question-topic" id="topicDisplay">Cơ cấu xã hội</div>
                <div class="question-difficulty" id="difficultyDisplay">⭐ Cơ bản</div>
            </div>
            
            <div class="question-text" id="questionDisplay">
                Đang tải câu hỏi...
            </div>
            
            <div class="answers" id="answersArea">
                <!-- Answers will be populated here -->
            </div>
            
            <div class="controls">
                <button class="btn btn-warning" onclick="useHint()">
                    <i class="fas fa-lightbulb"></i> Gợi ý (-50đ)
                </button>
                <button class="btn btn-secondary" onclick="skipQuestion()">
                    <i class="fas fa-forward"></i> Bỏ qua (-100đ)
                </button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation" id="navigationArea">
            <button class="btn btn-secondary" onclick="goToPrevious()" id="prevBtn">
                <i class="fas fa-chevron-left"></i> Trước
            </button>
            
            <div class="question-counter">
                Câu <span id="questionNumber">1</span> / <span id="totalQuestions">8</span>
            </div>
            
            <button class="btn btn-success" onclick="goToNext()" id="nextBtn">
                Sau <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <!-- Results -->
        <div class="results" id="resultsArea">
            <div class="results-card">
                <h2 style="color: var(--primary-red); margin-bottom: 1rem;">
                    <i class="fas fa-trophy"></i> Kết Quả Quiz
                </h2>
                
                <div class="final-score">
                    <span id="finalScoreDisplay">0</span> điểm
                </div>
                
                <div class="results-stats">
                    <div class="result-stat">
                        <span class="stat-number" style="color: #28a745;" id="correctDisplay">0</span>
                        <div class="stat-label">Câu đúng</div>
                    </div>
                    <div class="result-stat">
                        <span class="stat-number" style="color: #007bff;" id="answeredDisplay">0</span>
                        <div class="stat-label">Tổng câu</div>
                    </div>
                    <div class="result-stat">
                        <span class="stat-number" style="color: #ffc107;" id="accuracyDisplay">0%</span>
                        <div class="stat-label">Độ chính xác</div>
                    </div>
                    <div class="result-stat">
                        <span class="stat-number" style="color: #6c757d;" id="timeUsedDisplay">0s</span>
                        <div class="stat-label">Thời gian</div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-success" onclick="restartGame()">
                        <i class="fas fa-redo"></i> Chơi Lại
                    </button>
                    <button class="btn btn-primary" onclick="location.reload()">
                        <i class="fas fa-home"></i> Về Trang Chủ
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Game variables
var gameData = {
    currentQuestion: 0,
    score: 0,
    lives: 3,
    startTime: Date.now(),
    answers: []
};

// Updated questions based on new content
var questionsData = [
    {
        question: "Trong cơ cấu xã hội, nhóm cơ cấu nào có vị trí quan trọng hàng đầu, chi phối các loại hình cơ cấu xã hội khác?",
        options: [
            "Cơ cấu xã hội - giai cấp",
            "Cơ cấu dân tộc", 
            "Cơ cấu nghề nghiệp",
            "Cơ cấu tôn giáo"
        ],
        correct: 0,
        topic: "Cơ cấu xã hội",
        difficulty: "⭐ Cơ bản",
        hint: "Cơ cấu này liên quan đến sở hữu tư liệu sản xuất và quyền lực chính trị."
    },
    {
        question: "Liên minh giai cấp cơ bản trong thời kỳ quá độ lên chủ nghĩa xã hội ở Việt Nam gồm những thành phần nào?",
        options: [
            "Công nhân - Nông dân - Trí thức",
            "Tư sản - Nông dân - Công nhân",
            "Địa chủ - Nông dân - Tiểu tư sản", 
            "Doanh nhân - Trí thức - Tiểu chủ"
        ],
        correct: 0,
        topic: "Liên minh giai cấp",
        difficulty: "⭐ Cơ bản",
        hint: "Ba thành phần chính được liệt kê trong tài liệu về cơ cấu xã hội Việt Nam."
    },
    {
        question: "Theo số liệu năm 2025, lực lượng lao động Việt Nam đạt khoảng bao nhiêu người?",
        options: [
            "53.1 triệu người",
            "50 triệu người",
            "45 triệu người",
            "60 triệu người"
        ],
        correct: 0,
        topic: "Thống kê lao động",
        difficulty: "⭐⭐ Trung bình",
        hint: "Con số này được cập nhật trong quý II/2025, tăng 553 nghìn so với cùng kỳ."
    },
    {
        question: "GDP Việt Nam đã tăng bao nhiêu lần từ năm 1986 đến 2024 nhờ thành tựu của công cuộc Đổi mới?",
        options: [
            "59.5 lần",
            "35 lần",
            "20 lần",
            "100 lần"
        ],
        correct: 0,
        topic: "Thành tựu Đổi mới",
        difficulty: "⭐⭐ Trung bình",
        hint: "GDP tăng từ 8 tỷ USD (1986) lên 476.3 tỷ USD (2024)."
    },
    {
        question: "Tỷ lệ lao động nông nghiệp của Việt Nam đã giảm từ mức nào xuống mức nào trong giai đoạn 1986-2025?",
        options: [
            "Từ 70% xuống 27-30%",
            "Từ 80% xuống 50%",
            "Từ 60% xuống 40%",
            "Từ 90% xuống 60%"
        ],
        correct: 0,
        topic: "Chuyển dịch cơ cấu",
        difficulty: "⭐⭐ Trung bình",
        hint: "Đây là sự chuyển dịch mạnh mẽ từ nông nghiệp sang công nghiệp và dịch vụ."
    },
    {
        question: "Theo lý thuyết, quy luật biến đổi cơ cấu xã hội - giai cấp trong thời kỳ quá độ bao gồm mấy quy luật chính?",
        options: [
            "3 quy luật",
            "2 quy luật",
            "4 quy luật",
            "5 quy luật"
        ],
        correct: 0,
        topic: "Quy luật biến đổi",
        difficulty: "⭐⭐⭐ Nâng cao",
        hint: "Bao gồm: biến đổi gắn liền với cơ cấu kinh tế, biến đổi phức tạp đa dạng, và biến đổi từ đấu tranh đến liên minh."
    },
    {
        question: "Tầng lớp trí thức Việt Nam đã tăng từ tỷ lệ nào lên tỷ lệ nào trong giai đoạn 1990-2025?",
        options: [
            "Từ 5-10% lên 20-25%",
            "Từ 10% lên 30%",
            "Từ 15% lên 35%",
            "Từ 3% lên 15%"
        ],
        correct: 0,
        topic: "Tầng lớp trí thức",
        difficulty: "⭐⭐⭐ Nâng cao",
        hint: "Sự bùng nổ này bao gồm khoảng 1 triệu người trong lĩnh vực CNTT."
    },
    {
        question: "Trong thời kỳ quá độ lên chủ nghĩa xã hội, vì sao phải thực hiện liên minh giai cấp?",
        options: [
            "Để huy động sức mạnh tổng hợp, đáp ứng nhu cầu chung và tạo động lực phát triển",
            "Để loại bỏ hoàn toàn mâu thuẫn giai cấp",
            "Để thay thế vai trò lãnh đạo của Đảng",
            "Để chuyển sang chế độ tư bản chủ nghĩa"
        ],
        correct: 0,
        topic: "Ý nghĩa liên minh",
        difficulty: "⭐⭐⭐ Nâng cao",
        hint: "Đây là yêu cầu khách quan để thực hiện thắng lợi mục tiêu CNXH."
    }
];

// Load question function
function loadQuestion() {
    if (gameData.currentQuestion >= questionsData.length) {
        showResults();
        return;
    }

    var question = questionsData[gameData.currentQuestion];
    
    // Update displays
    document.getElementById('questionDisplay').textContent = question.question;
    document.getElementById('topicDisplay').textContent = question.topic;
    document.getElementById('difficultyDisplay').textContent = question.difficulty;
    
    // Update progress
    var current = gameData.currentQuestion + 1;
    var total = questionsData.length;
    document.getElementById('currentDisplay').textContent = current;
    document.getElementById('totalDisplay').textContent = total;
    document.getElementById('questionNumber').textContent = current;
    document.getElementById('totalQuestions').textContent = total;
    
    // Generate answers
    var answersContainer = document.getElementById('answersArea');
    answersContainer.innerHTML = '';
    
    var labels = ['A', 'B', 'C', 'D'];
    
    for (var i = 0; i < question.options.length; i++) {
        var answerDiv = document.createElement('div');
        answerDiv.className = 'answer';
        answerDiv.innerHTML = 
            '<div class="answer-label">' + labels[i] + '</div>' +
            '<div>' + question.options[i] + '</div>';
        answerDiv.onclick = createAnswerHandler(i);
        answersContainer.appendChild(answerDiv);
    }
    
    // Update navigation
    document.getElementById('prevBtn').disabled = gameData.currentQuestion === 0;
    
    if (gameData.currentQuestion === questionsData.length - 1) {
        document.getElementById('nextBtn').innerHTML = 'Kết thúc <i class="fas fa-flag-checkered"></i>';
    } else {
        document.getElementById('nextBtn').innerHTML = 'Sau <i class="fas fa-chevron-right"></i>';
    }
    
    updateStatsDisplay();
}

// Create answer handler (closure)
function createAnswerHandler(index) {
    return function() {
        selectAnswer(index);
    };
}

// Select answer function
function selectAnswer(selectedIndex) {
    var question = questionsData[gameData.currentQuestion];
    var answerElements = document.querySelectorAll('.answer');
    
    // Disable all answers
    for (var i = 0; i < answerElements.length; i++) {
        answerElements[i].classList.add('disabled');
    }
    
    // Mark selected
    answerElements[selectedIndex].classList.add('selected');
    
    // Show result after delay
    setTimeout(function() {
        answerElements[question.correct].classList.add('correct');
        
        var isCorrect = selectedIndex === question.correct;
        if (!isCorrect) {
            answerElements[selectedIndex].classList.add('incorrect');
            gameData.lives--;
        } else {
            gameData.score += 100;
        }
        
        // Store answer
        gameData.answers.push({
            question: gameData.currentQuestion,
            selected: selectedIndex,
            correct: question.correct,
            isCorrect: isCorrect
        });
        
        updateStatsDisplay();
        
        // Auto advance
        setTimeout(function() {
            goToNext();
        }, 2000);
        
    }, 500);
}

// Update stats display
function updateStatsDisplay() {
    document.getElementById('scoreDisplay').textContent = gameData.score;
    document.getElementById('livesDisplay').textContent = gameData.lives;
    
    var elapsed = Math.floor((Date.now() - gameData.startTime) / 1000);
    document.getElementById('timeDisplay').textContent = elapsed + 's';
}

// Use hint
function useHint() {
    var question = questionsData[gameData.currentQuestion];
    gameData.score = Math.max(0, gameData.score - 50);
    updateStatsDisplay();
    alert('💡 Gợi ý: ' + question.hint + '\n\n(-50 điểm)');
}

// Skip question
function skipQuestion() {
    gameData.score = Math.max(0, gameData.score - 100);
    gameData.lives--;
    
    gameData.answers.push({
        question: gameData.currentQuestion,
        selected: -1,
        correct: questionsData[gameData.currentQuestion].correct,
        isCorrect: false,
        skipped: true
    });
    
    updateStatsDisplay();
    alert('⏭️ Đã bỏ qua câu hỏi! (-100 điểm, -1 mạng)');
    
    setTimeout(function() {
        goToNext();
    }, 1000);
}

// Go to next
function goToNext() {
    gameData.currentQuestion++;
    
    if (gameData.currentQuestion >= questionsData.length || gameData.lives <= 0) {
        showResults();
    } else {
        loadQuestion();
    }
}

// Go to previous
function goToPrevious() {
    if (gameData.currentQuestion > 0) {
        gameData.currentQuestion--;
        loadQuestion();
    }
}

// Show results
function showResults() {
    document.getElementById('questionArea').style.display = 'none';
    document.getElementById('navigationArea').style.display = 'none';
    document.getElementById('resultsArea').style.display = 'block';
    
    // Calculate results
    var correctAnswers = 0;
    for (var i = 0; i < gameData.answers.length; i++) {
        if (gameData.answers[i].isCorrect) {
            correctAnswers++;
        }
    }
    
    var totalAnswered = gameData.answers.length;
    var accuracy = totalAnswered > 0 ? Math.round((correctAnswers / totalAnswered) * 100) : 0;
    var timeUsed = Math.floor((Date.now() - gameData.startTime) / 1000);
    
    // Update results display
    document.getElementById('finalScoreDisplay').textContent = gameData.score;
    document.getElementById('correctDisplay').textContent = correctAnswers;
    document.getElementById('answeredDisplay').textContent = totalAnswered;
    document.getElementById('accuracyDisplay').textContent = accuracy + '%';
    document.getElementById('timeUsedDisplay').textContent = timeUsed + 's';
}

// Restart game
function restartGame() {
    gameData.currentQuestion = 0;
    gameData.score = 0;
    gameData.lives = 3;
    gameData.startTime = Date.now();
    gameData.answers = [];
    
    document.getElementById('questionArea').style.display = 'block';
    document.getElementById('navigationArea').style.display = 'flex';
    document.getElementById('resultsArea').style.display = 'none';
    
    loadQuestion();
}

// Initialize game
window.onload = function() {
    loadQuestion();
    
    // Keyboard shortcuts
    document.onkeydown = function(e) {
        if (e.key >= '1' && e.key <= '4') {
            var answerIndex = parseInt(e.key) - 1;
            var answerElements = document.querySelectorAll('.answer');
            if (answerElements[answerIndex] && !answerElements[answerIndex].classList.contains('disabled')) {
                selectAnswer(answerIndex);
            }
        }
        
        if (e.code === 'Space') {
            e.preventDefault();
            useHint();
        }
        
        if (e.code === 'ArrowRight') {
            e.preventDefault();
            goToNext();
        }
        
        if (e.code === 'ArrowLeft') {
            e.preventDefault();
            goToPrevious();
        }
    };
};
</script>